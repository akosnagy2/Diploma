%----------------------------------------------------------------------------
\chapter{Pályakövetõ szabályozás - 10 oldal CsG/NA}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\section{Differenciális robotmodell - 4 oldal NA}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\subsection{Sebesség szabályozás - 2 oldal}
%----------------------------------------------------------------------------

%----------------------------------------------------------------------------
\subsection{Orientáció szabályozás - 2 oldal}
%----------------------------------------------------------------------------


%----------------------------------------------------------------------------
\section{Autószerû robotmodell - 4 oldal CsG}
%----------------------------------------------------------------------------
Ahogy láttuk a differenciális robot esetén, a pályakövetés problémáját szétbontottuk a pályába kódolt sebesség szabályozására, és orientáció szabályozásra. Az autószerû robotok esetén is hasonló módon járhatunk el. Mégis van néhány lényeges különbség a két robottípus közt. Míg a differenciális robot esetén a két kerék sebességével, addig az autószerû robot esetén a robot referencia pontjának tangenciális sebességével és a kormányszöggel tudunk beavatkozni.

\par
Ez az alsóbb szabályzási szinteken az következõ különbségeket jelenti: A differenciális robot esetén a szabályozó a pályából meghatározott sebesség és szögsebesség alapjelet szétválasztja keréksebességekre, mivel itt ez képzi a szabályozás beavatkozó jelét. Az autószerû robot esetén nincs szükség a szétválasztásra, a sebességet közvetlenül átadjuk az alsóbb szintû sebesség szabályozásnak, a kiszámított kormányszöget, pedig már a beavatkozó szervnek adjuk vissza.

%----------------------------------------------------------------------------
\subsection{Virtuális vonalkövezõ szabályozás - 2 oldal}
%----------------------------------------------------------------------------
A fentiekbõl látható, hogy a felsõbb szinten lévõ sebesség szabályozás módosítására nincs szükség, teljesen megegyezõ módon mûködhet mindkét robot esetén. Az orientáció szabályozás esetén már jelentõs különbségek mutatkoznak. Egy autószerû robot esetén nem hasznos a szögsebesség kiadása, mivel a beavatkozó jelünk a kormányszög. Természetesen a két mennyiség származtatható egymásból így ez nem jelentene akkora problémát.

\par
Az orientáció szabályzás alapötlete a differenciális robotnál, egy predikciós távolság meghatározása volt, mely alapján számítunk egy szöghibát, majd ebbõl szögsebesség beavatkozó jelet. Ezt a módszer nagyon hasonló a RobonAUT versenyen is látott vonalkövetõ autók szabályozására, azzal az elõnnyel, hogy itt sokkal pontosabban ismert a "vonal" helye és orientációja.

Az elõre tekintés miatt a mi célunk, hogy az autó eleje kövesse a vonalat, így \aref{eq:carLikeRobot} egyenleteit egy kicsit módosítanunk kell. Elsõ körben induljunk ki abból, hogy a virtuális szenzorunk az elsõ tengelynél található. \Aref{fig:carLikeRobotModel} ábrán alapján a következõkre jutunk:

\begin{align}\label{eq:carLikeRobotMod}
\dot{x} &= v \frac{\cos (\theta + \phi)}{\cos \phi} \notag \\
\dot{y} &= v \frac{\sin(\theta + \phi)}{\cos \phi} \notag \\
\dot{\theta} &= v \frac{\tan \phi}{L}
\end{align}

ahol, a jelölések megegyeznek \aref{eq:carLikeRobot} esetén használtakkal. Most vizsgáljuk meg, hogyan függ egy párhuzamos egyenes távolsága, a robot mozgásától:

\begin{align}\label{eq:parallelLine}
\dot{p} = -v \cdot \tan \phi
\end{align}

ahol, $p$ a virtuális szenzorunk közepének, és vonalnak az elõjeles távolsága. A képletbõl az is leolvasható, hogy pozitív kormányszög esetén az elõjeles távolság negatív irányba mozdul el. Most vizsgáljuk meg az autóhoz képest ferde vonal hatását:

\begin{align}\label{eq:crossLine}
\dot{p} = v \cdot \tan \delta
\end{align}

ahol, $\delta$ az autó haladásának egyenese, és a vonal egyenese által bezárt szög. Az eddigiek alapján felírhatjuk a $\delta$ és $p$ változását:

\begin{align}\label{eq:deltaAndp}
\dot{\delta} &= -v \frac{\tan \phi}{L} \notag \\
\dot{p} &= v \cdot \tan \delta - v \cdot \tan \phi - v \cdot \frac{p}{L} \tan \delta \tan \phi
\end{align}

Fontos megjegyezzük, hogy a rendszerünk nem lineáris, így a szuperpozíció se érvényes rá, innen az $\dot{p}$ esetén az utolsó tag. A szabályzó tervezés során nekünk egy lineáris rendszerre van szükségünk, így a fenti egyenletet linearizálni kell. Mivel az a célunk, hogy a robot a vonalon helyezkedjen el, és azzal párhuzamosan, így a munkapont, amely körül szeretnénk a linearizálást elvégezni a $p = 0$, $\phi = 0$ és a $\delta = 0$. Így a következõ egyenletekkel számolhatunk:

\begin{align}\label{eq:linearizedModel}
\dot{\delta} &= - \frac{v}{L} \phi \notag \\
\dot{p} &= v(\delta - \phi - 0)
\end{align}

A linearizálás egyszerû, mert a tangens 0 környezetében jól közelíthetõ az argumentumával. Látható, hogy a $\dot{p}$ esetén az utolsó tagot elhanyagoljuk, mivel a két kis szög szorzata annyira kis számot eredményez, hogy az elhagyható. Ha ezt kicsit más formában írjuk fel, rögtön megkapjuk a linearizált rendszer állapotteres leírását:

\begin{align}\label{eq:stateSpace}
x &= [\delta \quad p]^{T} \\ \notag
\dot{x} &= \begin{bmatrix}
0 & 0 \\
v & 0
\end{bmatrix}x + \begin{bmatrix}
-v/L \\
-v
\end{bmatrix} \phi \\ \notag
p &= [0 \quad 1]x + 0 \cdot \phi
\end{align}

Egy valós vonalkövetõ autóval ellentétben, mi igen pontosan meg tudjuk határozni a rendszer állapotváltozóit így célszerû közvetlenül ezek visszacsatolása, így szabadon megválaszthatóak a visszacsatolt rendszer pólusai. Ezt érdemes úgy megtenni, hogy minimálisra csökkentsük a túllendülést. Ha a rendszer válaszát kéttárolós lengõtaggal közelítjük, akkor annak átviteli függvénye a következõ:

\begin{align}\label{eq:kettarolosLengo}
W(s) = \frac{\omega_{0}^{2}}{\omega_{0}^{2} + 2\xi\omega_{0}s+s^{2}}
\end{align}

ahonnan a pólusok:

\begin{align}\label{eq:polusok}
s_{1,2} = -\omega_{0}\xi \pm j\omega_{0}\sqrt{1-\xi^{2}}
\end{align}

ahol $\omega_{0}$ a rendszer csillapítatlan sajátfrekvenciája és $\xi$ a csillapítási tényezõ. Ha túllendülés mentes rendszert szeretnénk, akkor a $\xi = 1$ kell válasszuk. Az $\omega_{0}$ megválasztása a kívánt beállási idõtõl függ.

\par
Az algoritmust úgy készítettük el, hogy az inicializálási fázisban a kívánt pólusoknak megfelelõen, az Ackermann-képlet segítségével kiszámítja az erõsítési tényezõket, és késõbb ezt használja fel a szabályzási fázisban. Az eredmények azt mutatták, hogy az így készült szabályozóval a szimulációban a robot trajektóriája a kanyarokat levágta. Ez az eredmény egyáltalán nem meglepõ, mivel a szabályozást úgy írtuk fel, hogy az autó eleje kövesse a pályát, de a pályatervezés során mi a robot referencia pontjának pályáját terveztük meg. Szerencsére ezt egyszerûen orvosolhatjuk, ha a mintavételezett pálya minden pontját eltoljuk az autó hosszával.




















